{"version":3,"sources":["meteor://ðŸ’»app/imports/api/apixu.js","meteor://ðŸ’»app/imports/api/darkSky.js","meteor://ðŸ’»app/imports/api/data.js","meteor://ðŸ’»app/imports/api/weatherStation.js","meteor://ðŸ’»app/server/main.js"],"names":["module","export","apixu","moment","watch","require","default","v","callback","startDate","location","formatedDate","format","Meteor","call","timeout","err","apixuData","apixuDataCurrent","apixuParsedData","apixuParsedCurrentData","data","forecast","forecastday","hour","forEach","push","temperature","temp_c","humidity","date","Date","time_epoch","getTime","current","last_updated_epoch","sort","a","b","historic","darkSky","currentTime","Math","round","darkSkyData","darkSkyParsedData","darkSkyParsedCurrentData","hourly","time","currently","postDataLoader","HTTP","weatherStation","callService","type","url","options","Promise","resolve","reject","error","result","getDiffVector","weatherStationData","dataVect","iTemp","iHumidity","diffTemp","diffHumidity","diff","record","sumTemperature","sumHumidity","nTemperature","nHumidity","actualTime","i","length","delta","abs","props","onData","env","match","params","d","setHours","midnight","isServer","methods","getPage","then","catch","Error","message","headers","weatherStationDataCurrent","WSParsedData","WSCurrentData","hits","hit","_source","attribute","value","TP","HD","lastDate","startup"],"mappings":"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","file":"/app.js","sourcesContent":["export {apixu}\nimport moment from 'moment'\nfunction apixu(callback,startDate,location){\n  var location = location?location:\"38.67,-9.2\";\n  var formatedDate = moment(startDate).format('YYYY-MM-DD')\n  Meteor.call('getPage','http://api.apixu.com/v1/history.json?key=05d72599bed946d8983155015170512&q='+location+'&dt='+formatedDate,{timeout:15000},function(err,apixuData){\n    Meteor.call('getPage','http://api.apixu.com/v1/current.json?key=05d72599bed946d8983155015170512&q='+location,{timeout:15000},function(err,apixuDataCurrent){\n      var apixuParsedData = [];\n      var apixuParsedCurrentData = {};\n      if(apixuData && apixuData.data && apixuData.data.forecast && apixuData.data.forecast.forecastday &&  apixuData.data.forecast.forecastday[0] && apixuData.data.forecast.forecastday[0].hour){\n\n        apixuData.data.forecast.forecastday[0].hour.forEach(hour=>{\n          apixuParsedData.push({\n            temperature:hour.temp_c,\n            humidity: hour.humidity,\n            date:(new Date(hour.time_epoch*1000)).getTime()\n          })\n        })\n\n\n      }\n      if(apixuDataCurrent && apixuDataCurrent.data && apixuDataCurrent.data.current){\n        apixuParsedCurrentData = {\n          date: (new Date(apixuDataCurrent.data.current.last_updated_epoch*1000)).getTime(),\n          temperature: apixuDataCurrent.data.current.temp_c,\n          humidity: apixuDataCurrent.data.current.humidity\n        }\n      }\n      apixuParsedData.sort(function(a,b) {return (a.date > b.date) ? 1 : ((b.date > a.date) ? -1 : 0);} );\n      callback({\n        historic: apixuParsedData,\n        current: apixuParsedCurrentData\n      },startDate);\n    });\n  });\n}\n","export {darkSky}\n\nfunction darkSky(callback,startDate,location){\n  var location = location?location:\"38.67,-9.2\";\n  var currentTime = Math.round((new Date(startDate)).getTime()/1000)\n  Meteor.call('getPage','https://api.darksky.net/forecast/7902d68f0b5648cce7b9b12139451974/'+location+','+currentTime+'?units=si',{timeout:15000},function(err,darkSkyData){\n    //Meteor.call('getPage','https://api.darksky.net/forecast/7902d68f0b5648cce7b9b12139451974/38.67,-9.2?units=si',function(err,darkSkyDataLast){\n\n    //Meteor.call('getPage','http://www.sapo.pt',function(err,darkSkyData){\n      var darkSkyParsedData = [];\n      var darkSkyParsedCurrentData = {}\n      if(darkSkyData && darkSkyData.data && darkSkyData.data.hourly && darkSkyData.data.hourly.data){\n        darkSkyData.data.hourly.data.forEach(data=>{\n          darkSkyParsedData.push({\n            temperature:data.temperature,\n            humidity: data.humidity*100,\n            date:(new Date(data.time*1000)).getTime()\n          })\n        })\n      }\n      if(darkSkyData &&  darkSkyData.data && darkSkyData.data.currently){\n        darkSkyParsedCurrentData = {\n          date: (new Date(darkSkyData.data.currently.time*1000)).getTime(),\n          temperature: darkSkyData.data.currently.temperature,\n          humidity: darkSkyData.data.currently.humidity*100\n        }\n      }\n      darkSkyParsedData.sort(function(a,b) {return (a.date > b.date) ? 1 : ((b.date > a.date) ? -1 : 0);} );\n      callback({\n        historic: darkSkyParsedData,\n        current: darkSkyParsedCurrentData\n      },startDate);\n    //});\n  });\n}\n","import { Meteor } from 'meteor/meteor';\nimport { HTTP } from 'meteor/http';\nimport {weatherStation} from './weatherStation.js'\nimport {apixu} from './apixu.js'\nimport {darkSky} from './darkSky.js'\nimport moment from 'moment'\nexport {postDataLoader}\n\nconst callService = (type, url, options) => new Promise((resolve, reject) => {\n  HTTP.call(type, url, options, (error, result) => {\n    if (error) {\n      reject(error);\n    } else {\n      resolve(result);\n    }\n  });\n});\n\nfunction getDiffVector(weatherStationData,dataVect){\n  var iTemp = 0;\n  var iHumidity = 0;\n  var diffTemp = [];\n  var diffHumidity = [];\n  var diff = []\n  if(dataVect.historic){\n    dataVect.historic.forEach(record=>{\n      var sumTemperature = null;\n      var sumHumidity = null;\n      var nTemperature = 0;\n      var nHumidity = 0;\n      var actualTime = (new Date()).getTime();\n      if(record.date<actualTime)\n      {\n        if(weatherStationData.historic){\n          for(var i=0;i<weatherStationData.historic.length;i++)\n          {\n            var delta = record.date-weatherStationData.historic[i].date\n\n            if(delta<3600000){\n              if(weatherStationData.historic[i].temperature)\n              {\n                sumTemperature = sumTemperature + weatherStationData.historic[i].temperature\n                nTemperature = nTemperature + 1;\n              }\n              if(weatherStationData.historic[i].humidity)\n              {\n                sumHumidity = sumHumidity + weatherStationData.historic[i].humidity\n                nHumidity = nHumidity + 1;\n              }\n            }else if(delta <0){\n              break;\n            }\n          }\n          if(sumTemperature && sumHumidity)\n          {\n\n            diff.push({\n              date: record.date,\n              temperature: Math.abs(sumTemperature/nTemperature - record.temperature),\n              humidity: Math.abs(sumHumidity/nHumidity - record.humidity)\n            })\n\n          }\n        }\n      }\n\n    })\n  }\n  return diff\n}\n\nfunction postDataLoader(props, onData,env) {\n  var location = env.location?env.location:\"38.67,-9.2\"\n  var date = new Date(props.match.params.date).getTime();\n  var d = new Date();\n  d.setHours(0,0,0,0);\n  var midnight = d.getTime();\n  var startDate = date?date:midnight;\n\n  // load data from the server. (using props.id to identify the post)\n  // (Here'll we'll use setTimeout for demonstration purpose)\n  weatherStation(function(weatherStationData,startDate){\n    apixu(function(apixuData,startDate){\n      darkSky(function(darkSkyData,startDate){\n        apixuData.diff = getDiffVector(weatherStationData,apixuData)\n        darkSkyData.diff = getDiffVector(weatherStationData,darkSkyData)\n        onData(null, {\n          weatherStation: weatherStationData,\n          apixu: apixuData,\n          darkSky: darkSkyData,\n          startDate: moment(startDate).format('YYYY-MM-DD')\n        })\n      },startDate,location);\n    },startDate,location);\n  },startDate)\n}\nif(Meteor.isServer){\n  Meteor.methods({\n    getPage(url,options) {\n      return callService(\n        'GET',\n        url,\n        options\n      ).then((result) => result).catch((error) => {\n        throw new Meteor.Error('500', `${error.message}`);\n      });\n    },\n  });\n}\n","export {weatherStation}\nimport moment from 'moment'\nfunction weatherStation(callback,startDate){\n  var formatedDate = moment(startDate).format('YYYY-MM-DD')\n  Meteor.call('getPage','http://elasticsearch.waziup.io/waziup-ui-weather/_search?q=name:WeatherStationUI&sort=time:desc&size=6000&q=time:'+formatedDate,{timeout:15000},function(err,weatherStationData){\n    //Meteor.call('getPage','http://elasticsearch.waziup.io/waziup-ui-weather/_search?q=name:WeatherStationUI&sort=time:desc&size=1',function(err,weatherStationDataLast){\n\n      Meteor.call('getPage','http://broker.waziup.io/v2/entities/WeatherStationUI',{\n        headers: {\n            \"Fiware-ServicePath\":\"/UI/WEATHER\",\n            \"Fiware-Service\":\"waziup\"\n          },\n          timeout: 15000\n        },function(err,weatherStationDataCurrent){\n          var WSParsedData = [];\n          var WSCurrentData = {}\n          var d = new Date();\n          d.setHours(0,0,0,0);\n          var midnight = d.getTime();\n          if(weatherStationData && weatherStationData.data && weatherStationData.data.hits && weatherStationData.data.hits.hits && weatherStationData.data.hits.hits.length )\n          {\n            weatherStationData.data.hits.hits.forEach(hit=>{\n              if((new Date(hit._source.time)).getTime()>midnight-3600000 || true){\n                if(hit._source)\n                {\n                  if(hit._source.attribute==\"TP\")\n                  {\n                    WSParsedData.push({\n                      date:(new Date(hit._source.time)).getTime(),\n                      temperature:hit._source.value\n                    })\n                  }\n                  if(hit._source.attribute==\"HD\")\n                  {\n                    WSParsedData.push({\n                      date:(new Date(hit._source.time)).getTime(),\n                      humidity:hit._source.value\n                    })\n                  }\n                }\n              }\n            })\n          }\n          WSParsedData.sort(function(a,b) {return (a.date > b.date) ? 1 : ((b.date > a.date) ? -1 : 0);} );\n          if(weatherStationDataCurrent && weatherStationDataCurrent.data)\n          {\n            var temperature = null;\n            for(var i=WSParsedData.length-1;i>0;i--)\n            {\n              if(WSParsedData[i].temperature){\n                temperature = WSParsedData[i].temperature\n                break;\n              }\n            }\n            var humidity = null;\n            for(var i=WSParsedData.length-1;i>0;i--)\n            {\n              if(WSParsedData[i].humidity){\n                humidity = WSParsedData[i].humidity\n                break;\n              }\n            }\n            if(weatherStationDataCurrent.data.TP){\n              //WSCurrentData.temperature = weatherStationDataCurrent.data.TP.value\n              WSCurrentData.temperature = temperature\n            }\n            if(weatherStationDataCurrent.data.HD){\n              //WSCurrentData.humidity = weatherStationDataCurrent.data.HD.value\n              WSCurrentData.humidity = humidity\n            }\n            var lastDate = null;\n            /*if(weatherStationDataLast){\n              if(weatherStationDataLast.data){\n                if(weatherStationDataLast.data.hits){\n                  if(weatherStationDataLast.data.hits.hits){\n                    if(weatherStationDataLast.data.hits.hits.length){\n                      lastDate = weatherStationDataLast.data.hits.hits[0].sort[0]\n                    }\n                  }\n                }\n              }\n            }*/\n            if(WSParsedData.length){\n              WSCurrentData.date = WSParsedData[WSParsedData.length-1].date\n            }\n\n          }\n          callback({\n            historic: WSParsedData,\n            current: WSCurrentData\n          },startDate);\n      })\n    //});\n  })\n}\n","import { Meteor } from 'meteor/meteor';\nimport '../imports/api/data.js'\nMeteor.startup(() => {\n  // code to run on server at startup\n\n});\n"]}